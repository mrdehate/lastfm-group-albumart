function getRecentArt(t){var r="http://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks&user="+t+"&limit=2&api_key="+LASTFM_API_KEY+"&format=json";return $.getJSON(r,function(r){if(void 0===r.recenttracks||void 0===r.recenttracks.track)return 0;var e=r.recenttracks.track[0].artist["#text"],a=r.recenttracks.track[0].name,n=r.recenttracks.track[0].image[3]["#text"],o=r.recenttracks.track[0].album.mbid;if(r.recenttracks.track[0]["@attr"]&&"true"===r.recenttracks.track[0]["@attr"].nowplaying){var i="";i="<div class='entry'>",i+="<div class='user'>"+t+"</div>",i+="<div class='artistOuter'><span class='artist'>"+e+"</span></div>",i+="<div class='songOuter'><span class='song'>"+a+"</span></div>",i+="<img class='imgArt' src='"+getCoverArt(n,e,o,a)+"' /><br />",i+="</div>",$(".cover").append(i)}gApiCallCounter++}),!0}function getCoverArt(t,r,e,a){var n="";return""===t?(n=backupAlbumArtCoverArchive(e),""===t&&(n=backupAlbumArtEchoNest(r,a),""===n&&(n=getArtistArt(r),""===n&&(n=BLANK_COVER_URL)))):n=t,n}function getArtistArt(t){var r="";return $.ajax({url:"http://ws.audioscrobbler.com/2.0/?method=artist.getinfo&artist="+encodeURIComponent(t)+"&api_key="+LASTFM_API_KEY+"&format=json",async:!1}).done(function(t){try{r=t.artist.image[2]["#text"]}catch(e){}gApiCallCounter++}),r}function backupAlbumArtCoverArchive(t){var r="";return""===t||null===t?r:($.ajax({url:"http://coverartarchive.org/release/"+t,async:!1}).done(function(t){try{r=t.images.thumbnails.small["#text"]}catch(e){}}),r)}function backupAlbumArtEchoNest(t,r){var e="";return""===t||null===t||""===r||null===r?e:($.ajax({url:"http://developer.echonest.com/api/v4/song/search?api_key="+ECHONEST_API_KEY+"&format=json&results=1&artist="+encodeURIComponent(t)+"&title="+encodeURIComponent(r)+"&bucket=id:7digital-US&bucket=tracks",async:!1}).done(function(t){try{e=t.response.songs[0].tracks[0].release_image}catch(r){}}),e)}function getArtistChart(){var t="http://ws.audioscrobbler.com/2.0/?method=group.getweeklyartistchart&api_key="+LASTFM_API_KEY+"&group="+THE_GROUP+"&format=json";return $.getJSON(t,function(t){var r=new Date,e=new Date;try{r.setTime(1e3*t.weeklyartistchart["@attr"].from),e.setTime(1e3*t.weeklyartistchart["@attr"].to)}catch(a){r=null,e=null}$(".artistChart h3").html(""),r&&e&&$(".artistChart h3").html($.datepicker.formatDate("M dd",r)+" - "+$.datepicker.formatDate("M dd",e));for(var n=new Array,o=0;t.weeklyartistchart.artist[o]&&t.weeklyartistchart.artist[o].playcount&&t.weeklyartistchart.artist[o].playcount>1;)n[o]=t.weeklyartistchart.artist[o].name,o++;$(".artistChart ol").html("");var i;for(i=0;25>i&&void 0!==n[i];i++)$(".artistChart ol").append("<li>"+n[i]+"</li>");gApiCallCounter++}),!0}function displayAlbumArt(){var t="http://ws.audioscrobbler.com/2.0/?method=group.getmembers&api_key="+LASTFM_API_KEY+"&group="+THE_GROUP+"&format=json";return $.getJSON(t,function(t){for(var r=new Array,e=0;t.members.user[e];)r[e]=t.members.user[e].name,e++;$(".cover").html("");for(var a=0;r[a];)getRecentArt(r[a]),a++;$(".updateTime").html((new Date).toLocaleTimeString()),gApiCallCounter++}),!0}function updateApiCounter(){$(".stats").html("API/sec: "+(gApiCallCounter/((Date.now()-gStartupTime)/1e3)).toFixed(2))}var LASTFM_API_KEY="e63ca8d5b65415a4ee36b32260dce956",ECHONEST_API_KEY="TU0XNU2PKBGD5AIJ2",THE_GROUP="WorkForce Software",BLANK_COVER_URL="http://upload.wikimedia.org/wikipedia/commons/b/b9/No_Cover.jpg",REFRESH_INTERVAL=6e4,DAY_REFRESH_INTERVAL=864e5,gApiCallCounter=0,gStartupTime=Date.now();setInterval(displayAlbumArt,REFRESH_INTERVAL),setInterval(updateApiCounter,REFRESH_INTERVAL),getArtistChart(),setInterval(getArtistChart,DAY_REFRESH_INTERVAL);
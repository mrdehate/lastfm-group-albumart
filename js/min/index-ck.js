function getRecentArt(t){var r="http://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks&user="+t+"&limit=2&api_key="+LASTFM_API_KEY+"&format=json";return $.getJSON(r,function(r){if(void 0===r.recenttracks||void 0===r.recenttracks.track)return 0;var e=r.recenttracks.track[0].artist["#text"],a=r.recenttracks.track[0].name,i=r.recenttracks.track[0].image[3]["#text"];if(r.recenttracks.track[0]["@attr"]&&"true"===r.recenttracks.track[0]["@attr"].nowplaying){var s="";s="<div class='entry'>",s+="<div class='user'>"+t+"</div>",s+="<div class='artistOuter'><span class='artist'>"+e+"</span></div>",s+="<div class='songOuter'><span class='song'>"+a+"</span></div>",s+="<img class='imgArt' src='"+getCoverArt(i,e)+"' /><br />",s+="</div>",$(".cover").append(s)}gApiCallCounter++}),!0}function getCoverArt(t,r){var e="";return""===t?($.ajax({url:"http://ws.audioscrobbler.com/2.0/?method=artist.getinfo&artist="+r+"&api_key="+LASTFM_API_KEY+"&format=json",async:!1}).done(function(t){try{e=t.artist.image[2]["#text"]}catch(r){e=BLANK_COVER_URL}gApiCallCounter++}),""===e&&(e=BLANK_COVER_URL)):e=t,e}function getArtistChart(){var t="http://ws.audioscrobbler.com/2.0/?method=group.getweeklyartistchart&api_key="+LASTFM_API_KEY+"&group="+THE_GROUP+"&format=json";return $.getJSON(t,function(t){var r=new Date,e=new Date;try{r.setTime(1e3*t.weeklyartistchart["@attr"].from),e.setTime(1e3*t.weeklyartistchart["@attr"].to)}catch(a){r=null,e=null}$(".artistChart h3").html(""),r&&e&&$(".artistChart h3").html($.datepicker.formatDate("M dd",r)+" - "+$.datepicker.formatDate("M dd",e));for(var i=new Array,s=0;t.weeklyartistchart.artist[s]&&(console.log(t.weeklyartistchart.artist[s].playcount),t.weeklyartistchart.artist[s].playcount&&t.weeklyartistchart.artist[s].playcount>1);)i[s]=t.weeklyartistchart.artist[s].name,s++;$(".artistChart ol").html("");var o;for(o=0;25>o&&void 0!==i[o];o++)$(".artistChart ol").append("<li>"+i[o]+"</li>");gApiCallCounter++}),!0}function displayAlbumArt(){var t="http://ws.audioscrobbler.com/2.0/?method=group.getmembers&api_key="+LASTFM_API_KEY+"&group="+THE_GROUP+"&format=json";return $.getJSON(t,function(t){for(var r=new Array,e=0;t.members.user[e];)r[e]=t.members.user[e].name,e++;$(".cover").html("");for(var a=0;r[a];)getRecentArt(r[a]),a++;var i=new Date;$(".updateTime").html(i.getHours()+":"+i.getMinutes()+":"+i.getSeconds()),gApiCallCounter++}),!0}function updateApiCounter(){$(".stats").html("API/sec: "+(gApiCallCounter/((Date.now()-gStartupTime)/1e3)).toFixed(2))}var LASTFM_API_KEY="e63ca8d5b65415a4ee36b32260dce956",THE_GROUP="WorkForce Software",BLANK_COVER_URL="http://upload.wikimedia.org/wikipedia/commons/b/b9/No_Cover.jpg",REFRESH_INTERVAL=6e4,DAY_REFRESH_INTERVAL=864e5,gApiCallCounter=0,gStartupTime=Date.now();setInterval(displayAlbumArt,REFRESH_INTERVAL),setInterval(updateApiCounter,REFRESH_INTERVAL),getArtistChart(),setInterval(getArtistChart,DAY_REFRESH_INTERVAL);